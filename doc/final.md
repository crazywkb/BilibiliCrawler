---
layout: page
mathjax: true
permalink: /2019/projects/p07/final/


---

## 基于用户行为和番剧特征的b站番剧推荐

#### 成员及分工

| 成员   | 分工                               |
| ------ | ---------------------------------- |
| 李嘉盛 | 系统设计，算法实现，文档编写       |
| 曹昊天 | 关联规则挖掘，数据分析，数据可视化 |
| 万凯斌 | 数据爬取，数据预处理，模型评估     |



### 1. 题目介绍



### 2. 模型描述

#### 关联规则挖掘

关联规则挖掘是一种基于规则的机器学习算法，该算法可以在大数据库中发现感兴趣的关系。“尿布与啤酒”是一个典型的关联规则挖掘的例子，沃尔玛为了能够准确了解顾客在其门店的购买习惯，对其顾客的购物行为进行购物篮分析，想知道顾客经常一起购买的商品有哪些。沃尔玛利用所有用户的历史购物信息来进行挖掘分析，一个意外的发现是："跟尿布一起购买最多的商品竟是啤酒！

关联规则挖掘算法不仅被应用于购物篮分析，还被广泛的应用于网页浏览偏好挖掘，入侵检测，连续生产和生物信息学领域，以及本项目所做的推荐系统。

我们所选用的关联规则挖掘算法时FP-Growth算法，算法的实现主要分为三个步骤：建立项头表、建立TP-Tree、基于FP-Tree进行关联规则挖掘。

##### 建立项头表

FP树的建立需要首先依赖项头表的建立。我们第一次扫描数据，得到所有频繁一项集的的计数。然后删除支持度低于阈值的项，将1项频繁集放入项头表，并按照支持度降序排列。接着第二次也是最后一次扫描数据，将读到的原始数据剔除非频繁1项集，并按照支持度降序排列。

![](https://ws1.sinaimg.cn/large/0061Qobaly1g5nxi2bipzj305a08fq30.jpg)

如上图所示为一个建立好的项头表，其中A、C、E、G、B、D、F为挖掘出的频繁项集。

##### 建立FP-Tree

有了项头表和排序后的数据集，我们就可以开始FP-Tree的建立了。开始时FP-Tree没有数据，建立FP-Tree时我们一条条的读入排序后的数据集，插入FP-Tree，插入时按照排序后的顺序，插入FP-Tree中，排序靠前的节点是祖先节点，而靠后的是子孙节点。如果有共用的祖先，则对应的公用祖先节点计数加1。插入后，如果有新节点出现，则项头表对应的节点会通过节点链表链接上新节点。直到所有的数据都插入到FP-Tree后，FP-Tree的建立完成。

![](https://ws1.sinaimg.cn/large/0061Qobaly1g5nxi2ot4fj30go0ddgo6.jpg)



如上图所示，是一个建好后的FP-Tree

##### 基于FP-Tree进行关联规则挖掘

得到了FP树和项头表以及节点链表，我们首先要从项头表的底部项依次向上挖掘。对于项头表对应于FP树的每一项，我们要找到它的条件模式基。所谓条件模式基是以我们要挖掘的节点作为叶子节点所对应的FP子树。得到这个FP子树，我们将子树中每个节点的的计数设置为叶子节点的计数，并删除计数低于支持度的节点。从这个条件模式基，就可以递归挖掘得到频繁项集了。

![](https://ws1.sinaimg.cn/large/0061Qobaly1g5nxi2lyj2j30n009x0uh.jpg)

上图右侧展示了E的条件模式基，递归挖掘到E的最大频繁项集为频繁3项集。

#### 推荐算法设计

##### 基于关联规则直接进行推荐

在通过FP-Growth算法得到了关联规则后，我们根据关联规则的置信度对所有规则进行了排序。在对某个用户进行推荐时，将用户的过往观看记录与关联规则的前项进行匹配，从而得到备选关联规则，再从备选关联规则中选择置信度最高规则的后项作为给该用户推荐的番剧。

##### 基于属性权重的改进 

为了能使推荐系统的准确率更高，我们不把置信度作为评价关联规则的唯一标准，而是将番剧评分、追番用户数、播放量及番剧的画师、声优阵容等番剧属性也纳入了考虑范围内。我们为置信度和上述属性设置了权重，并通过调参来不断调整权重分配，使得推荐系统能更加精确。

### 3. 数据处理

#### 缺失值处理

缺失值主要来源于爬虫爬取数据过程中的意外操作，如用户的隐私设置了非公开，番剧被下架，用户本身处于[小黑屋](https://www.bilibili.com/blackboard/blackroomrule_v16.html)状态，都有一定可能导致数据的缺失。此外，由于B站本身的反爬机制，所以在高速爬取时会被IP限制，所以使用IP池的方法进行绕过时，代理IP的不稳定性也可能导致一定量的数据缺失，但是比例较小，所以可以忽略不计。

对于这类缺失值的处理方法一般采用直接丢弃的方法，因为缺失的数据占比较小，且大多数缺失数据本身不具有特征倾向，所以直接丢弃即可。但是对于被下架番剧的信息缺失，可以考虑从百度快照等缓存网站获取最近一次的缓存信息进行补充。而由于代理IP出现的信息缺失情况，在爬虫的中间件部分设置了缺失重爬的逻辑，所以只需要在最后的爬取结果中进行一次去重操作即可。



#### 非法数据处理

B站本身的数据其实也存在一定的错误率，例如在声优及职员列表中，经常出现



### 4. 结果分析

代码泄露

与b站自身的推荐系统相比，我们考虑了画师、声优阵容

### 5. 小结



###### 项目地址：[BilibiliCrawler](https://github.com/crazywkb/BilibiliCrawler)